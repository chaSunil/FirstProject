<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="visit">
	<!-- 전체 조회 -->
	<select id="visit_list" resultType="visit">
		select 
			rownum as no, v.*
		from 
			(select * from visit order by idx desc) v
	</select>
	
	<!-- 검색 조회 type="db.vo.VisitVo" => alias="visit" -->
	<select id="visit_list_condition" parameterType="Map" resultType="visit">
		select * from visit_view
		<!-- Dynamic Query: 조건별 Query -->
		<!-- 유사검색 길동이라는 단어가 있는 데이터를 검색 -->
		<!-- where name like '%길동%' -->
		<!-- 만약 where prefix 다음에 or가 나오게 되면 trim 해라. -->
		<trim prefix="where" prefixOverrides="or">
			<if test="name!=null">
				name like '%' || #{ name } || '%'
			</if>
			<if test="content!=null">
				or content like '%' || #{ content } || '%'
			</if>
		</trim>
	</select>
	
	<!-- 추가 
		 parameter가 객체(VisitVo)로 전달되면 mybatis parameter 변수는
		 VO내의 속성명을 이용할 수 있다.
	-->
	<insert id="visit_insert" parameterType="db.vo.VisitVo">
		insert into visit values(
		                         seq_visit_idx.nextVal,
		                         #{ name },
		                         #{ content },
		                         #{ pwd },
		                         #{ ip },
		                         sysdate
		                         )
	</insert>
	
	<!-- 삭제 -->
	<delete id="visit_delete" parameterType="int">
		delete from visit where idx= #{ idx }
	</delete>
	
	<!-- 한개 조회 -->
	<select id="visit_one" resultType="db.vo.VisitVo" parameterType="int">
		select * from visit_view where idx = #{ idx }
	</select>
	
	<!-- 수정하기 -->
	<update id="visit_update" parameterType="db.vo.VisitVo">
		update visit set name = #{ name },
		                 content = #{ content },
		                 pwd = #{ pwd },
		                 ip = #{ ip },
		                 regdate = sysdate
		                 where idx = #{ idx }
	</update>
	
	

</mapper>













